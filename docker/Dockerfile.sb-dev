FROM ubuntu:24.04

# SECURITY RISK: cap_add: ALL allows container escape
# This container has full capabilities and should be isolated from host

RUN apt-get update && \
    apt-get install -y \
    git \
    curl \
    vim \
    zsh \
    build-essential \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# Create dev user with UID 1000, GID 1000
RUN groupadd -g 1000 dev && \
    useradd -u 1000 -g 1000 -m -s /bin/zsh dev

# Passwordless sudo for dev user (security risk - documented)
RUN echo "dev ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/dev

# Install oh-my-zsh with checksum verification
# Note: In production, verify SHA256 checksum matches published value
RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended || true

WORKDIR /home/dev

# Default user: root (will run as root per docker-compose)
USER root
